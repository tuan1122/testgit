<template>
  <div style="padding: 40px">
    <el-input
      v-model="display"
      style="width: 260px"
      placeholder="Enter USD"
      @input="handleInput"
      @blur="formatFinal"
    >
    </el-input>

    <p>Number value: {{ value }}</p>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

// ====== STATE ======
const value = ref<number>(124); // số thật (mặc định)
const display = ref('123.00'); // chuỗi hiển thị (mặc định)

// ====== Khi đang gõ ======
function handleInput(val: string) {
  // chỉ cho nhập số và dấu .
  let raw = val.replace(/[^\d.]/g, '');

  // chỉ cho 1 dấu .
  const parts = raw.split('.');
  if (parts.length > 2) {
    raw = parts[0] + '.' + parts.slice(1).join('');
  }

  // giới hạn 2 số sau dấu .
  if (parts[1]?.length > 2) {
    raw = parts[0] + '.' + parts[1].slice(0, 2);
  }

  // cập nhật display khi đang gõ
  display.value = raw;

  // cập nhật số thật
  value.value = raw === '' || raw === '.' ? 0 : Number(raw);
}

// ====== Khi rời khỏi input ======
function formatFinal() {
  display.value = value.value.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });
}

function normalizeUsd(val: number | string): string {
  if (val === null || val === undefined || val === '') return '0.00';

  const num = Number(val);

  if (isNaN(num)) return '0.00';

  return num.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });
}
</script>
