<template>
  <div style="padding: 40px">
    <el-input
      v-model="display"
      style="width: 260px"
      placeholder="Enter USD"
      @input="handleInput"
      @blur="formatFinal"
    >
    </el-input>

    <p>Number value: {{ value }}</p>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

// ====== STATE ======
const value = ref<number>(124); // số thật (mặc định)
const display = ref('123.00'); // chuỗi hiển thị (mặc định)

// ====== Khi đang gõ ======
function handleInput(val: string) {
  // Chỉ cho nhập số và dấu .
  let raw = val.replace(/[^\d.]/g, '');

  // Chỉ cho tồn tại 1 dấu .
  const firstDot = raw.indexOf('.');
  if (firstDot !== -1) {
    raw =
      raw.substring(0, firstDot + 1) +
      raw.substring(firstDot + 1).replace(/\./g, '');
  }

  // Tách phần nguyên và thập phân
  let [intPart, decPart] = raw.split('.');

  // Giới hạn 10 chữ số phần nguyên
  if (intPart.length > 10) {
    intPart = intPart.slice(0, 10);
  }

  // Giới hạn 2 chữ số phần thập phân
  if (decPart !== undefined) {
    decPart = decPart.slice(0, 2);
    raw = intPart + '.' + decPart;
  } else {
    raw = intPart;
  }

  // Trường hợp người dùng vừa gõ dấu "."
  if (raw.endsWith('.') && decPart === undefined) {
    raw = intPart + '.';
  }

  // Cập nhật display
  display.value = raw;

  // Cập nhật giá trị số thực
  if (raw === '' || raw === '.') {
    value.value = 0;
  } else {
    value.value = Number(raw);
  }
}

// ====== Khi rời khỏi input ======
function formatFinal() {
  display.value = value.value.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });
}

function normalizeUsd(val: number | string): string {
  if (val === null || val === undefined || val === '') return '0.00';

  const num = Number(val);

  if (isNaN(num)) return '0.00';

  return num.toLocaleString('en-US', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  });
}
</script>
